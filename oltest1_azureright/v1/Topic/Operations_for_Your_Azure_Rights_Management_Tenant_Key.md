---
description: na
keywords: na
title: Operations for Your Azure Rights Management Tenant Key
search: na
ms.date: na
ms.service: rights-management
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 1284d0ee-0a72-45ba-a64c-3dcb25846c3d
---
# Операции для ключа клиента Azure Rights Management
В зависимости от топологии ключа клиента (с управлением Майкрософт или с управлением клиентом) вы получаете разные уровни контроля и ответственности за ключ клиента Microsoft Azure Rights Management (Azure RMS) после его реализации.

Сценарий управления собственным ключом клиента часто называется BYOK (bring your own key — с использованием собственного ключа). Дополнительные сведения об этом сценарии и о выборе между двумя топологиями ключа клиента см. в разделе [Планирование и реализация ключа клиента службы Azure Rights Management](../Topic/Planning_and_Implementing_Your_Azure_Rights_Management_Tenant_Key.md).

В следующей таблице приводятся операции, которые можно выполнять в зависимости от выбранной топологии ключа клиента Azure RMS.

|Операция жизненного цикла|С управлением Майкрософт (по умолчанию)|С управлением клиентом (BYOK)|
|-----------------------------|-------------------------------------------|---------------------------------|
|Отзыв ключа клиента|Нет (автоматически)|Нет (автоматически)|
|Повторное создание ключа клиента|Да|Да|
|Резервное копирование и восстановление ключа клиента|Нет|Да|
|Экспорт ключа клиента|Да|Нет|
|Реакция на нарушения|Да|Да|
После определения реализованной топологии смотрите описание этих операций для своего ключа клиента Azure RMS в одном из следующих разделов.

## <a name="BKMK_MSManagedOperations"></a>С управлением Майкрософт: операции жизненного цикла ключа клиента
Если ваш ключ клиента для Azure Rights Management управляется Майкрософт (по умолчанию), сведения об операциях жизненного цикла, относящихся к этой топологии, см. в следующих разделах.

-   [Отзыв ключа клиента](../Topic/Operations_for_Your_Azure_Rights_Management_Tenant_Key.md#BKMK_MSRevoke)

-   [Повторное создание ключа клиента](../Topic/Operations_for_Your_Azure_Rights_Management_Tenant_Key.md#BKMK_MSRekey)

-   [Резервное копирование и восстановление ключа клиента](../Topic/Operations_for_Your_Azure_Rights_Management_Tenant_Key.md#BKMK_MSBackup)

-   [Экспорт ключа клиента](../Topic/Operations_for_Your_Azure_Rights_Management_Tenant_Key.md#BKMK_MSExport)

-   [Реакция на нарушения](../Topic/Operations_for_Your_Azure_Rights_Management_Tenant_Key.md#BKMK_MSBreach)

### <a name="BKMK_MSRevoke"></a>Отзыв ключа клиента
При отмене подписки на Azure RMS использование вашего ключа клиента прекращается, и не требуются никакие дополнительные действия.

### <a name="BKMK_MSRekey"></a>Повторное создание ключа клиента
Повторное создание ключа также называется обновлением ключа. Не следует повторно создавать ключ клиента, пока это не будет действительно необходимо. Старые клиенты, например Office 2010, не были предназначены для корректной обработки изменений ключа. В этом сценарии необходимо очистить состояние RMS на компьютерах с помощью групповой политики или аналогичного механизма. Однако бывают определенные события, в которых повторное создание ключа клиента будет оправданно и необходимо. Например:

-   Компания разделяется на несколько компаний. При повторном создании ключа клиента новая компания не будет иметь доступ к новому контенту, публикуемому вашими сотрудниками. Но новая компания будет иметь доступ к старому контенту, если получит копию старого ключа клиента.

-   Существуют основания предполагать, что мастер-копия ключа клиента (принадлежащая вам) была скомпрометирована.

Можно повторно создать ключ клиента, позвонив в службу поддержки корпорации Microsoft (CSS) и доказав, что вы являетесь администратором клиента.

После повторного создания ключа клиента новый контент будет защищаться с помощью нового ключа клиента. Это происходит поэтапно, поэтому на протяжении некоторого периода времени часто нового контента будет по-прежнему защищаться старым ключом клиента. Ранее защищенный контент остается защищенным старым ключом клиента. Для поддержки этого сценария Azure RMS сохраняет старый ключ клиента, и он может выдавать лицензии для старого контента.

### <a name="BKMK_MSBackup"></a>Резервное копирование и восстановление ключа клиента
За резервное копирование ключа клиента отвечает Майкрософт; с вашей стороны никакие действия не требуются.

### <a name="BKMK_MSExport"></a>Экспорт ключа клиента
Можно экспортировать конфигурацию Azure RMS и ключ клиента, следуя инструкциям в следующих трех шагах.:

##### Шаг 1. Инициация экспорта

-   Для этого обратитесь в службу поддержки клиентов Майкрософт (CSS). Необходимо представить доказательства, что вы являетесь администратором клиента Azure RMS.

##### Шаг 2. Ожидание верификации

-   Майкрософт проверяет законность вашего запроса на выпуск ключа клиента RMS. Этот процесс может занять до 3 недель.

##### Шаг 3 Получение ключевых инструкций от CSS

-   Служба поддержки клиентов Майкрософт (CSS) отправит вам конфигурацию Azure RMS и ключ клиента в виде зашифрованного и защищенного паролем файла с расширением TPD. Для этого CSS сначала отправит вам (или лицу, инициировавшему экспорт) инструмент по электронной почте. Необходимо запустить этот инструмент в командной строке следующим образом:

    ```
    AadrmTpd.exe -createkey
    ```
    Будет создана пара ключей RSA; открытая и закрытая части будут сохранены в виде файлов в текущей папке. Например, **PublicKey-FA29D0FE-5049-4C8E-931B-96C6152B0441.txt** и **PrivateKey-FA29D0FE-5049-4C8E-931B-96C6152B0441.txt**.

    Ответьте на электронное письмо от CSS, вложив файл, имя которого начинается с **PublicKey**. Затем CSS отправит TPD-файл в виде XML-файла, зашифрованного вашим ключом RSA. Скопируйте этот файл в ту же папку, где изначально использовалось средство AadrmTpd, и снова запустите программу, используя файл, который начинается с **PrivateKey**, и файл из CSS. Например:

    ```
    AadrmTpd.exe -key PrivateKey-FA29D0FE-5049-4C8E-931B-96C6152B0441.txt -target TPD-77172C7B-8E21-48B7-9854-7A4CEAC474D0.xml
    ```
    В результате должны быть получены два файла: один с текстовым паролем для защищенного паролем TPD-файла, другой с самим TPD-файлом. Для перекрестных ссылок оба файла должны иметь тот же GUID, что и файлы открытого и закрытого ключей при запуске команды AadrmTpd.exe -createkey:

    -   Password-FA29D0FE-5049-4C8E-931B-96C6152B0441.txt

    -   ExportedTPD-FA29D0FE-5049-4C8E-931B-96C6152B0441.xml

    Создайте резервную копию этих файлов и сохраните ее в безопасном месте, чтобы можно было продолжать расшифровку контента, защищенного этим ключом клиента. Кроме того, при переходе на AD RMS можно импортировать этот TPD-файл (начинается с **ExportedTDP**) на сервер AD RMS.

##### Шаг 4. Текущие действия: защита ключа клиента

-   После получения ключа клиента необходимо надежно его защитить, так как любой человек, который получит к нему доступ, сможет расшифровать все документы, защищенные с использованием данного ключа

    Если ключ клиент экспортируется потому, что вы не желаете дальше использовать Azure RMS, рекомендуется деактивировать клиент RMS прямо сейчас. Не откладывайте эту операцию после получения ключа клиента, поскольку данная мера предосторожности позволит свести к минимуму последствия в случае доступа к вашему ключу клиента со стороны неуполномоченного лица Инструкции см. в разделе [Деактивация службы Azure Rights Management и вывод ее из использования](../Topic/Decommissioning_and_Deactivating_Azure_Rights_Management.md).

### <a name="BKMK_MSBreach"></a>Реакция на нарушения
Ни одна система безопасности, как бы она ни была сильна, не обходится без процесса реагирования на нарушения. Ключ клиента может быть скомпрометирован или перехвачен. Даже если он хорошо защищен, могут быть найдены уязвимости в технологии HSM текущего поколения или в текущей длине и алгоритмах ключа.

В Майкрософт имеется специальная группа реагирования на угрозы безопасности в наших продуктах и службах. Как только появляется достоверное сообщение об инциденте, эта группа приступает к исследованиям области, корневой причины и способов устранения. Если этот инцидент может повлиять на ваши активы, Майкрософт будет уведомлять администраторов вашего клиента Azure RMS по электронной почте, используя адрес, указанный при подписке.

Если обнаруживается нарушение, то оптимальные действия, которые можно предпринять, зависят от области нарушения; в этом процессе Майкрософт будет работать совместно с вами. В следующей таблице приведены некоторые распространенные ситуации и возможные ответы, хотя точная реакция будет зависеть от всей информации, выявленной во время исследования.

|Описание инцидента|Вероятный ответ|
|----------------------|-------------------|
|Произошла утечка ключа клиента.|Повторно создайте ключ клиента. См. раздел [Повторное создание ключа клиента](../Topic/Operations_for_Your_Azure_Rights_Management_Tenant_Key.md#BKMK_MSRekey) в этой статье.|
|Неавторизованное лицо или вредоносное ПО получило права на использование ключа клиента, но утечка самого ключа клиента не произошла.|В этой ситуации повторное создание ключа клиента не поможет, и необходимо выполнить анализ основной причины. Если получение доступа несанкционированным лицом произошло вследствие ошибки в процессе или программе, то такую ситуацию необходимо исправить.|
|Уязвимость, обнаруженную в алгоритме RSA, в длине ключа или в результате атаки методом "грубой силы", возможно вычислить.|Корпорация Майкрософт обязуется обновлять Azure RMS для поддержки новых алгоритмов и более длинных ключей, которые более устойчивы, и инструктировать всех клиентов, чтобы они обновляли свои ключи клиента.|

## <a name="BKMK_BYOKManagedOperations"></a>С управлением клиентом: операции жизненного цикла ключа клиента
Если вы управляете своим ключом клиента для Azure Rights Management (сценарий с использованием собственного ключа, или BYOK), сведения об операциях жизненного цикла, относящихся к этой топологии, см. в следующих разделах.

-   [Отзыв ключа клиента](../Topic/Operations_for_Your_Azure_Rights_Management_Tenant_Key.md#BKMK_BYOKRevoke)

-   [Повторное создание ключа клиента](../Topic/Operations_for_Your_Azure_Rights_Management_Tenant_Key.md#BKMK_BYOKRekey)

-   [Резервное копирование и восстановление ключа клиента](../Topic/Operations_for_Your_Azure_Rights_Management_Tenant_Key.md#BKMK_BYOKBackup)

-   [Экспорт ключа клиента](../Topic/Operations_for_Your_Azure_Rights_Management_Tenant_Key.md#BKMK_BYOKExport)

-   [Реакция на нарушения](../Topic/Operations_for_Your_Azure_Rights_Management_Tenant_Key.md#BKMK_BYOKBreach)

### <a name="BKMK_BYOKRevoke"></a>Отзыв ключа клиента
При отмене подписки на Azure RMS использование вашего ключа клиента прекращается, и не требуются никакие дополнительные действия.

### <a name="BKMK_BYOKRekey"></a>Повторное создание ключа клиента
Повторное создание ключа также называется обновлением ключа. Не следует повторно создавать ключ клиента, пока это не будет действительно необходимо. Старые клиенты, например Office 2010, не были предназначены для корректной обработки изменений ключа. В этом сценарии необходимо очистить состояние RMS на компьютерах с помощью групповой политики или аналогичного механизма. Однако бывают определенные события, в которых повторное создание ключа клиента будет оправданно и необходимо. Например:

-   Компания разделяется на несколько компаний. При повторном создании ключа клиента новая компания не будет иметь доступ к новому контенту, публикуемому вашими сотрудниками. Но новая компания будет иметь доступ к старому контенту, если получит копию старого ключа клиента.

-   Существуют основания предполагать, что мастер-копия ключа клиента (принадлежащая вам) была скомпрометирована.

После повторного создания ключа клиента новый контент будет защищаться с помощью нового ключа клиента. Это происходит поэтапно, поэтому на протяжении некоторого периода времени часто нового контента будет по-прежнему защищаться старым ключом клиента. Ранее защищенный контент остается защищенным старым ключом клиента. Для поддержки этого сценария Azure RMS сохраняет старый ключ клиента, и он может выдавать лицензии для старого контента.

Чтобы повторно создать ключ клиента, генерируйте или создайте новый ключ по Интернету или лично, используя процедуры раздела [Реализация BYOK](../Topic/Planning_and_Implementing_Your_Azure_Rights_Management_Tenant_Key.md#BKMK_ImplementBYOK) этой статьи [Планирование и реализация ключа клиента службы Azure Rights Management](../Topic/Planning_and_Implementing_Your_Azure_Rights_Management_Tenant_Key.md).

### <a name="BKMK_BYOKBackup"></a>Резервное копирование и восстановление ключа клиента
Вы отвечаете за резервное копирование своего ключа клиента. Если ключ клиента был создан в Thales HSM, то для резервного копирования ключа просто создайте резервные копии файла ключа с токеном, файла World и карт администратора.

Если ключ передается с помощью процедур из раздела [Реализация BYOK](../Topic/Planning_and_Implementing_Your_Azure_Rights_Management_Tenant_Key.md#BKMK_ImplementBYOK) статьи [Планирование и реализация ключа клиента службы Azure Rights Management](../Topic/Planning_and_Implementing_Your_Azure_Rights_Management_Tenant_Key.md), Azure RMS будет сохранять файл ключа с токеном для защиты на случай сбоя какого-либо узла Azure RMS. Однако не следует считать это полным резервным копированием. Например, если когда-нибудь понадобится текстовая копия ключа для использования вне Thales HSM, Azure RMS не сможет ее создать, поскольку имеет только невосстанавливаемую копию.

### <a name="BKMK_BYOKExport"></a>Экспорт ключа клиента
При использовании BYOK нельзя экспортировать ключ клиента из Azure RMS. Копия в Azure RMS не является восстанавливаемой. Если вы хотите удалить этот ключ, чтобы он больше не использовался, обратитесь в службу поддержки пользователей Майкрософт (CSS).

### <a name="BKMK_BYOKBreach"></a>Реакция на нарушения
Ни одна система безопасности, как бы она ни была сильна, не обходится без процесса реагирования на нарушения. Ключ клиента может быть скомпрометирован или перехвачен. Даже если он хорошо защищен, могут быть найдены уязвимости в технологии HSM текущего поколения или в текущей длине и алгоритмах ключа.

В Майкрософт имеется специальная группа реагирования на угрозы безопасности в наших продуктах и службах. Как только появляется достоверное сообщение об инциденте, эта группа приступает к исследованиям области, корневой причины и способов устранения. Если этот инцидент может повлиять на ваши активы, Майкрософт будет уведомлять администраторов вашего клиента Azure RMS по электронной почте, используя адрес, указанный при подписке.

Если обнаруживается нарушение, то оптимальные действия, которые можно предпринять, зависят от области нарушения; в этом процессе Майкрософт будет работать совместно с вами. В следующей таблице приведены некоторые распространенные ситуации и возможные ответы, хотя точная реакция будет зависеть от всей информации, выявленной во время исследования.

|Описание инцидента|Вероятный ответ|
|----------------------|-------------------|
|Произошла утечка ключа клиента.|Повторно создайте ключ клиента. См. раздел [Повторное создание ключа клиента](../Topic/Operations_for_Your_Azure_Rights_Management_Tenant_Key.md#BKMK_BYOKRekey) в этой статье.|
|Неавторизованное лицо или вредоносное ПО получило права на использование ключа клиента, но утечка самого ключа клиента не произошла.|В этой ситуации повторное создание ключа клиента не поможет, и необходимо выполнить анализ основной причины. Если получение доступа несанкционированным лицом произошло вследствие ошибки в процессе или программе, то такую ситуацию необходимо исправить.|
|Уязвимость обнаружена в технологии HSM текущего поколения.|Корпорация Майкрософт должна обновить HSM. Если есть основания предполагать, что эта уязвимость может раскрыть ключи, то Майкрософт проинструктирует всех клиентов обновить свои ключи.|
|Уязвимость, обнаруженную в алгоритме RSA, в длине ключа или в результате атаки методом "грубой силы", возможно вычислить.|Корпорация Майкрософт обязуется обновлять Azure RMS для поддержки новых алгоритмов и более длинных ключей, которые более устойчивы, и инструктировать всех клиентов, чтобы они обновляли свои ключи клиента.|

## См. также
[Использование службы Azure Rights Management](../Topic/Using_Azure_Rights_Management.md)

