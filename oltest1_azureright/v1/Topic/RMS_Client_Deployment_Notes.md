---
description: na
keywords: na
title: RMS Client Deployment Notes
search: na
ms.date: na
ms.service: rights-management
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 03cc8c6f-3b63-4794-8d92-a5df4cdf598f
---
# Заметки к развертыванию клиента RMS
Клиент службы Rights Management (клиент RMS) версии 2 также называется "клиент MSIPC". Это программное обеспечение для компьютеров под управлением Windows, взаимодействующее с локальными или облачными службами Microsoft Rights Management. Оно предназначено для защиты доступа к информации и для ее использования по мере ее прохождения через приложения и устройства в пределах организации или за этими управляемыми границами. Помимо доставки вместе с [приложением для управления доступом Rights Management для Windows](https://technet.microsoft.com/library/dn919648.aspx), клиент RMS доступен [как файл для дополнительной загрузки](http://www.microsoft.com/download/details.aspx?id=38396), который после подтверждения и принятия лицензионного соглашения можно свободно распространять вместе со сторонним программным обеспечением, чтобы клиенты могли защищать и использовать содержимое, защищенное с помощью служб Rights Management.

Этот раздел включает следующие подразделы:

-   [Повторное распространение клиента RMS](#BKMK_RedistributeInstaller)

-   [Установка клиента RMS](#BKMK_InstallClient)

-   [Вопросы и ответы о клиенте RMS](#BKMK_QA)

-   [Параметры клиента RMS](#BKMK_Settings)

-   [Только AD RMS: Ограничение использования клиентом RMS доверенных серверов AD RMS](#BKMK_UsingTrustedServers)

-   [Обнаружение службы RMS](#BKMK_ServiceDiscovery)

## <a name="BKMK_RedistributeInstaller"></a>Повторное распространение клиента RMS
Клиент RMS можно свободно распространять повторно вместе с другими приложениями и ИТ-решениями. Если разработчику приложения или поставщику решений требуется повторно распространять клиент RMS, есть два варианта.

-   Рекомендуемый Внедрите установщик клиента RMS в установку приложения и запускайте его в автоматическом режиме (параметр **/quiet**, который описывается в следующем разделе).

-   Сделайте клиент RMS необходимым компонентом для работы приложения. В этом случае необходимо предоставить пользователям дополнительные инструкции для получения и установки клиента на компьютер, прежде чем они смогут использовать приложение.

## <a name="BKMK_InstallClient"></a>Установка клиента RMS
Клиент RMS содержится в исполняемом файле установщика с именем **setup_msipc_***&lt;архитектура&gt;***.exe**, где *&lt;архитектура&gt;* — это либо **x86** (для 32-разрядных компьютеров), либо **x64** (для 64-разрядных компьютеров). Пакет установщика для 64-разрядных систем (x64) устанавливает как 32-разрядный исполняемый файл для совместимости с 32-разрядными приложениями, работающими в 64-разрядной операционной системе, так и 64-разрядный исполняемый файл для поддержки нативных 64-разрядных приложений. 32-разрядный (x86) установщик не будет выполняться в 64-разрядной версии Windows.

> [!NOTE]
> Требуется более высокий уровень привилегий, чтобы установить клиент RMS, например права члена группы администраторов на локальном компьютере.

Можно установить клиент RMS с помощью любого из следующих методов установки.

-   **Автоматический режим** Используя параметр **/quiet** в составе параметров командной строки, клиент RMS можно установить без вмешательства пользователя. В следующем примере показана установка клиента RMS в автоматическом режиме на 64-разрядном клиентском компьютере:

    ```
    setup_msipc_x64.exe /quiet
    ```

-   **Интерактивный режим** Также клиент RMS можно установить с помощью программы установки на основе графического интерфейса пользователя, предоставляемого мастером установки клиента RMS. Для этого дважды щелкните пакет установщика клиента службы RMS (**setup_msipc_***&lt;архитектура&gt;***.exe**) в папке, в которую он был скопирован или загружен, на локальном компьютере.

## <a name="BKMK_QA"></a>Вопросы и ответы о клиенте RMS
В следующем разделе приведены часто задаваемые вопросы о клиент RMS и ответы на них.

### Какие операционные системы поддерживают клиент RMS?
Клиент RMS поддерживается в следующих операционных системах:

|Серверная операционная система Windows|Клиентская операционная система Windows|
|------------------------------------------|-------------------------------------------|
|Windows Server 2012 R2|Windows 8.1|
|Windows Server 2012|Windows 8|
|Windows Server 2008 R2|Windows 7 с пакетом обновления 1 (SP1) и более поздними версиями пакетов обновления|
|Windows Server 2008 (только AD RMS)|Windows Vista с пакетом обновления 2 (SP2) и более поздними версиями пакетов обновления (только AD RMS)|

### Какие процессоры или платформы поддерживают клиент RMS?
Клиент RMS поддерживается на 32-разрядных (x86) и 64-разрядных (x64) вычислительных платформах.

### Куда устанавливается клиент RMS?
По умолчанию клиент RMS устанавливается в папку %ProgramFiles%\Active Directory Rights Management Services Client 2.&lt;дополнительный_номер_версии&gt;.

### Какие файлы связаны с клиентом RMS?
Следующие файлы устанавливаются в рамках клиентского программного обеспечения RMS:

-   Msipc.dll

-   Ipcsecproc.dll

-   Ipcsecproc_ssp.dll

-   MSIPCEvents.man

Кроме этих файлов, клиент RMS устанавливает файлы поддержки многоязычного пользовательского интерфейса (MUI) для 44 языков. Чтобы проверить поддерживаемые языки, запустите установку клиента RMS и после завершения установки просмотрите содержимое папки многоязычной поддержки в пути по умолчанию.

### Устанавливается ли клиент RMS по умолчанию вместе с поддерживаемой операционной системой?
Нет. Эта версия клиента RMS поставляется в виде дополнительной загрузки, которую можно установить отдельно на компьютерах под управлением поддерживаемых версий операционной системы Microsoft Windows.

### Обновляется ли клиент RMS автоматически через Центр обновления Майкрософт?
При установке данного клиента RMS в автоматическом режиме он наследует текущие параметры Центра обновления Майкрософт. Если клиент RMS установлен с помощью программы установки на основе графического интерфейса пользователя, мастер установки клиента RMS предложит включить поддержку Центра обновления Майкрософт.

## <a name="BKMK_Settings"></a>Параметры клиента RMS
Следующий раздел содержит сведения о параметрах клиента RMS. Эти сведения могут быть полезны при возникновении проблем с приложениями или службами, которые используют клиент RMS.

> [!NOTE]
> Некоторые параметры зависят от того, выполняется ли приложение с поддержкой RMS как приложение в режиме клиента (например, Microsoft Word и Outlook или приложение для управления доступом RMS) или как приложение в режиме сервера (например, SharePoint и Exchange).  В следующих таблицах эти параметры определяются соответственно как **режим клиента** и **режим сервера**.

### Где клиент RMS хранит лицензии на клиентских компьютерах
Клиент RMS хранит лицензии на локальном диске и кэширует некоторые сведения в реестре Windows.

|Описание|Пути режима клиента|Пути режима сервера|
|------------|-----------------------|-----------------------|
|Расположение хранилища лицензий|%localappdata%\Microsoft\MSIPC|%allusersprofile%\Microsoft\MSIPC\Server\*&lt;SID&gt;*\|
|Расположение хранилища шаблонов|%localappdata%\Microsoft\MSIPC\Templates|%allusersprofile%\Microsoft\MSIPC\Server\Templates\*&lt;SID&gt;*\|
|Расположение реестра|HKEY_CURRENT_USER<br /> \Software<br /> \Classes<br /> \Local Settings<br /> \Software<br /> \Microsoft<br /> \MSIPC|HKEY_CURRENT_USER<br /> \Software<br /> \Microsoft<br /> \MSIPC<br /> \Server<br /> \*&lt;SID&gt;*|
> [!NOTE]
> *&lt;SID&gt;* — это идентификатор безопасности (SID) для учетной записи, с которой выполняется серверное приложение. Например, если приложение выполняется с использованием встроенной учетной записи сетевой службы, замените *&lt;SID&gt;* на значение хорошо известного SID для этой учетной записи (S-1-5-20).

### Параметры реестра Windows для клиента RMS
Разделы реестра Windows можно использовать для задания или изменения некоторых конфигураций клиента RMS. Например, администратор приложения с поддержкой RMS, взаимодействующего с серверами AD RMS, может обновить расположение корпоративной службы (переопределить сервер AD RMS, выбранный сейчас для публикации) в зависимости от текущего расположения клиентского компьютера в топологии Active Directory. Также можно включить трассировку RMS на клиентском компьютере для устранения проблем с приложением с поддержкой RMS. Используйте следующую таблицу для определения параметров реестра, которые можно изменить для клиента RMS.

|Задача|Параметры|
|----------|-------------|
|Только AD RMS: Чтобы обновить расположение корпоративной службы для клиентского компьютера|Обновите следующие разделы реестра:<br /><br />-   HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSIPC\ServiceLocation\EnterpriseCertification<br />    REG_SZ: default<br />    **Значение:** &lt;http или https&gt;:// *имя_кластера_RMS*/_wmcs/Certification<br />-   HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSIPC\ServiceLocation\EnterprisePublishing<br />    REG_SZ: default<br />    **Значение:** &lt;http или https&gt;:// *имя_кластера_RMS*/_wmcs/Licensing|
|Включение и отключение трассировки|Обновите следующий раздел реестра:<br /><br />-   HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSIPC<br />    REG_DWORD: Трассировка<br />    **Значение:** 1, чтобы включить трассировку, 0, чтобы отключить трассировку (по умолчанию)|
|Изменение частоты обновления шаблонов в днях|Следующие параметры реестра указывают, как часто будут обновляться шаблоны на компьютере пользователя, если значение TemplateUpdateFrequencyInSeconds не задано.  Если ни одно из этих значений не задано, то интервал обновления по умолчанию для приложений, использующих клиент RMS (версия 1.0.1784.0) для загрузки шаблонов, — 1 день. Более ранние версии имеют значение по умолчанию, равное 7 дням.<br /><br />**Режим клиента:**<br /><br />-   HKEY_CURRENT_USER\Software\Classes\Local Settings\Software\Microsoft\MSIPC<br />    REG_DWORD: TemplateUpdateFrequency<br />    **Значение:** Целочисленное значение, указывающее количество дней (не менее 1) между загрузками.<br /><br />**Режим сервера:**<br /><br />-   HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSIPC\Server\*&lt;SID&gt;*<br />    REG_DWORD: TemplateUpdateFrequency<br />    **Значение:** Целочисленное значение, указывающее количество дней (не менее 1) между загрузками.|
|Изменение частоты обновления шаблонов в секундах **Important:** Если этот параметр указан, значение для обновления шаблонов в днях игнорируется. Укажите одно из этих значений, но не оба.|Следующие параметры реестра указывают, как часто будут обновляться шаблоны на компьютере пользователя. Если это значение или значение частоты в днях (TemplateUpdateFrequency) не заданы, то интервал обновления по умолчанию для приложений, использующих клиент RMS (версия 1.0.1784.0) для загрузки шаблонов, — 1 день. Более ранние версии имеют значение по умолчанию, равное 7 дням.<br /><br />**Режим клиента:**<br /><br />-   HKEY_CURRENT_USER\Software\Classes\Local Settings\Software\Microsoft\MSIPC<br />    REG_DWORD: TemplateUpdateFrequencyInSeconds<br />    **Значение:** Целочисленное значение, указывающее количество секунд (не менее 1) между загрузками.<br /><br />**Режим сервера:**<br /><br />-   HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSIPC\Server\*&lt;SID&gt;*<br />    REG_DWORD: TemplateUpdateFrequencyInSeconds<br />    **Значение:** Целочисленное значение, указывающее количество секунд (не менее 1) между загрузками.|
|Только AD RMS Немедленная загрузка шаблонов при следующем запросе публикации|Во время тестирования и оценки может потребоваться, чтобы клиент RMS загрузил шаблоны как можно быстрее. Для этого удалите следующий раздел реестра, и клиент RMS будет загружать шаблоны немедленно при следующем запросе публикации, а не ожидать в течение времени, заданного параметром реестра TemplateUpdateFrequency:<br /><br />-   HKEY_CURRENT_USER\Software\Classes\Local Settings\Software\Microsoft\MSIPC\&lt;имя_сервера&gt;\Template **Note:** Заполнитель &lt;имя_сервера&gt; может иметь внешние (corprights.contoso.com) и внутренние (corprights) URL-адреса, поэтому существуют две различные записи.|
|Только AD RMS Включение поддержки федеративной проверки подлинности|Если компьютер клиента RMS подключается к кластеру AD RMS с помощью федеративного отношения доверия, необходимо настроить домашнюю область федерации.<br /><br />-   HKEY_LOCAL_MACHINE\Software\Microsoft\MSIPC\Federation<br />    REG_SZ: FederationHomeRealm<br />    **Значение:** Этот параметр реестра — универсальный код ресурса (URI) для службы федерации (например, https://fs-01.contoso.com).|
|Только AD RMS Поддержка серверов федерации партнеров, требующих проверки подлинности на основе форм для ввода данных пользователем|По умолчанию клиент RMS работает в автоматическом режиме, и пользователю не требуется вводить данные. При этом серверы федерации партнера могут быть настроены так, чтобы требовать ввода данных пользователя, например через проверку подлинности на основе форм. В этом случае необходимо настроить клиент RMS на пропуск автоматического режима, чтобы федеративная форма проверки подлинности появлялась в окне браузера и пользователю предлагалось пройти проверку подлинности.<br /><br />-   HKEY_LOCAL_MACHINE\Software\Microsoft\MSIPC\Federation<br />    REG_DWORD: EnableBrowser **Note:** Если на сервере федерации настроена проверка подлинности на основе форм, этот ключ является обязательным. Если на сервере федерации настроено использование встроенной проверки подлинности Windows, этот ключ необязателен.|
|Только AD RMS Блокировка использования службы ILS|По умолчанию клиент RMS включает использование содержимого, защищенного службой ILS, но можно настроить для клиента блокировку данной службы, задав следующий раздел реестра. Если в этом разделе реестра задана блокировка службы ILS, любые попытки открыть и использовать содержимое, защищенное службой, приведут к следующей ошибке:<br />HRESULT_FROM_WIN32(ERROR_ACCESS_DISABLED_BY_POLICY)<br /><br />-   HKEY_CURRENT_USER\Software\Classes\Local Settings\Software\Microsoft\MSIPC<br />    REG_DWORD: **DisablePassportCertification**<br />    **Значение:** 1 — блокировать использование ILS, 0 — разрешить использование ILS (по умолчанию)|

### Управление распределением шаблонов для клиента RMS
Шаблоны ускоряют для пользователей и администраторов применение защиты Rights Management, и клиент RMS автоматически загружает шаблоны с серверов или из службы RMS. Если разместить шаблоны в следующей папке, то клиент RMS не будет загружать шаблоны из расположения по умолчанию, а вместо этого будет загружать шаблоны из этой папки. Клиент RMS может по-прежнему загружать шаблоны с других доступных серверов RMS.

**Режим клиента:** %localappdata%\Microsoft\MSIPC\UnmanagedTemplates

**Режим сервера:** %allusersprofile%\Microsoft\MSIPC\Server\UnmanagedTemplates\*&lt;SID&gt;*

При использовании этой папки нет обязательного специального соглашения об именах, но шаблоны должны быть выданы сервером или службой RMS и должны иметь расширение XML. Например, Contoso-Confidential.xml или Contoso-ReadOnly.xml являются допустимыми именами.

## <a name="BKMK_UsingTrustedServers"></a>Только AD RMS: Ограничение использования клиентом RMS доверенных серверов AD RMS
Клиент RMS может быть ограничен в использовании только определенными доверенными серверами AD RMS, если внести следующие изменения в реестр Windows на локальных компьютерах.

**Включение ограничения на использование клиентом RMS только доверенных серверов AD RMS**

-   HKEY_LOCAL_MACHINE\Software\Microsoft\MSIPC\TrustedServers\
    REG_DWORD: AllowTrustedServersOnly

    **Значение:** Если указано ненулевое значение, клиент RMS будет доверять только указанным серверам, настроенным в списке TrustedServers и в службе Azure Rights Management.

**Добавление элементов в список доверенных серверов AD RMS**

-   HKEY_LOCAL_MACHINE\Software\Microsoft\MSIPC\TrustedServers\
    REG_SZ: *&lt;URL-адрес_или_имя_узла&gt;*

    **Значение:** Строковые значения, добавленные в этот раздел реестра, могут быть DNS-именами домена (например **adrms.contoso.com**) или полными URL-адресами доверенных серверов AD RMS (например **https://adrms.contoso.com**). Если указанный URL-адрес начинается с **https://**, клиент RMS будет использовать протокол SSL или TLS для связи с сервером AD RMS.

## <a name="BKMK_ServiceDiscovery"></a>Обнаружение службы RMS
Обнаружение службы RMS позволяет клиенту RMS проверить, с каким сервером или службой RMS будет выполняться взаимодействие, прежде чем защищать содержимое. Обнаружение службы также может произойти, когда клиент RMS использует защищенное содержимое, но это менее вероятно, так как в подключенной к содержимому политике имеется предпочтительный сервер или служба RMS, и клиент запустит службу обнаружения, только если к ним не удалось подключиться.

Обнаружение службы сначала ищет локальную версию Rights Management (AD RMS). Если она отсутствует, служба обнаружения автоматически ищет облачную версию Rights Management (Azure RMS).

Чтобы обнаружить службу для локального развертывания, клиент RMS проверяет следующее.

1.  Реестр Windows на локальном компьютере: если параметры обнаружения службы настроены в реестре, эти параметры будут применяться первыми.  По умолчанию эти параметры не настроены в реестре.

2.  Доменные службы Active Directory: Подключенный к домену компьютер запрашивает в Active Directory точку подключения службы (SCP). Если точка подключения службы зарегистрирована, клиенту RMS возвращается URL-адрес службы RMS.

### Только AD RMS включение обнаружения службы на стороне сервера с помощью Active Directory
Если ваша учетная запись имеет достаточно привилегий (администраторы предприятия и локальный администратор для сервера AD RMS), можно автоматически зарегистрировать точку подключения службы (SCP) при установке сервера корневого кластера AD RMS. Если точка подключения службы уже существует в лесу, сначала необходимо удалить ее, а затем регистрировать новую.

Точку подключения службы можно зарегистрировать и удалить после установки AD RMS с помощью следующей процедуры. Перед началом убедитесь, что учетная запись имеет необходимые привилегии (администраторы предприятия и локальный администратор для сервера AD RMS).

##### Включение обнаружения службы AD RMS с помощью регистрации точки подключения службы в Active Directory

1.  Откройте консоль управления служб Active Directory на сервере AD RMS:

    -   Если вы используете Windows Server 2008 R2 или Windows Server 2008, нажмите кнопку **Пуск**, щелкните **Администрирование** и выберите **Службы Active Directory Rights Management**.

    -   Если вы используете Windows Server 2012 R2 или Windows Server 2012, в диспетчере сервера нажмите **Сервис** и щелкните **Службы Active Directory Rights Management**.

2.  В консоли AD RMS щелкните правой кнопкой мыши кластер AD RMS и нажмите **Свойства**.

3.  Перейдите на вкладку **SCP**.

4.  Установите флажок **Сменить SCP**.

5.  Выберите **Задать SCP для текущего кластера сертификации**, а затем нажмите кнопку **ОК**.

### Включение обнаружения службы на стороне клиента с помощью реестра Windows
В качестве альтернативы использованию SCP или в случаях, когда точка подключения службы не существует, можно настроить реестр на клиентском компьютере, чтобы клиент RMS мог найти свой сервер AD RMS.

##### Включение обнаружения службы AD RMS на стороне клиента с помощью реестра Windows

1.  Откройте редактор реестра Windows, Regedit.exe:

    -   На клиентском компьютере в окне "Выполнить" введите **regedit**, а затем нажмите клавишу ВВОД, чтобы открыть редактор реестра.

2.  В редакторе реестра перейдите в раздел **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSIPC**.

    > [!IMPORTANT]
    > Если вы используете 32-разрядное приложение на 64-разрядном компьютере, путь будет следующим: 
    > **HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\MSIPC**

3.  Чтобы создать подраздел ServiceLocation, щелкните правой кнопкой мыши **MSIPC**, щелкните **Создать**, нажмите **Ключ**, а затем введите **ServiceLocation**.

4.  Чтобы создать подраздел EnterpriseCertification, щелкните правой кнопкой мыши **ServiceLocation**, щелкните **Создать**, нажмите **Ключ**, а затем введите **EnterpriseCertification**.

5.  Чтобы задать URL-адрес сертификации предприятия, дважды щелкните значение **(По умолчанию)** в подразделе **EnterpriseCertification** и, когда откроется диалоговое окно **Изменение строкового параметра**, в поле **Значение** введите &lt;http or https&gt;://*AD RMS_cluster_name*/_wmcs/Certification и нажмите кнопку **ОК**.

6.  Чтобы создать подраздел EnterprisePublishing, щелкните правой кнопкой мыши **ServiceLocation**, щелкните **Создать**, нажмите **Ключ**, а затем введите EnterprisePublishing.

7.  Чтобы задать URL-адрес публикации предприятия, дважды щелкните значение **(По умолчанию)** в подразделе **EnterprisePublishing** и, когда откроется диалоговое окно **Изменение строкового параметра**, в поле **Значение** введите &lt;http or https&gt;://*AD RMS_cluster_name*/_wmcs/Licensing и нажмите кнопку **ОК**.

8.  Закройте редактор реестра.

Если клиент RMS не находит точку подключения службы с помощью запроса к Active Directory и эта точка не указана в реестре, вызовы AD RMS службой обнаружения завершатся ошибкой.

### Перенаправление трафика сервера лицензирования
В некоторых случаях может потребоваться перенаправить трафик во время обнаружения службы, например когда две организации объединены, старый сервер лицензирования в одной из организаций больше не используется и нужно перенаправлять клиенты на новый сервер лицензирования. Другой пример — если выполняется перенос из AD RMS в Azure RMS. Чтобы включить перенаправление лицензирования, используйте следующую процедуру.

##### Включение перенаправления лицензирования RMS с помощью реестра Windows

1.  Откройте редактор реестра Windows, Regedit.exe:

    -   На клиентском компьютере в окне «Выполнить» введите**regedit**, а затем нажмите клавишу ВВОД, чтобы открыть редактор реестра.

2.  В редакторе реестра перейдите к одному из следующих разделов:

    -   Для 64-разрядной версии Office на 64-разрядной (x64) платформе: HKLM\SOFTWARE\Microsoft\MSIPC\Servicelocation

    -   Для 32-разрядной версии Office на 64-разрядной (x64) платформе: HKLM\SOFTWARE\Wow6432Node\Microsoft\MSIPC\Servicelocation

3.  Создайте подраздел LicensingRedirection, щелкнув правой кнопкой мыши **Servicelocation**, щелкните **Создать**, щелкните **Ключ** и затем введите **LicensingRedirection**.

4.  Чтобы задать перенаправление лицензирования, щелкните правой кнопкой мыши подраздел **LicensingRedirection**, щелкните **Создать** и выберите **Строковое значение**.  В качестве **имени** укажите URL-адрес предыдущего сервера лицензирования, а в поле **Значение** укажите URL-адрес нового сервера лицензирования.

    Например, чтобы перенаправить лицензирование с сервера Contoso.com на Fabrikam.com, можно ввести следующие значения:

    **Имя:** `https://contoso.com/_wmcs/licensing`

    **Значение:** `https://fabrikam.com/_wmcs/licensing`

    > [!NOTE]
    > Если для старого сервера лицензирования указаны URL-адреса интрасети и экстрасети, то новые сопоставления имени и значения должны быть заданы для обоих URL-адресов в разделе LicensingRedirection.

5.  Повторите предыдущий шаг для всех серверов, которые должны перенаправляться.

6.  Закройте редактор реестра.

